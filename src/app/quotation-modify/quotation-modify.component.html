<app-main-head [activenav]="'create-quotation'"></app-main-head>
<main class="main main-quotation">
  <header class="header-page">
    <div class="breadcrumb">
      <a routerLink="/dashboard" class="back-link">Cancel Creating Quotation</a>
    </div>
    <h3 class="pullup">03. Get Quote and Modify</h3>
    <div class="status" *ngIf="quote.vSel3">Status: {{quote.vSel3.status}}</div>
  </header>
  <!-- /.header-sn -->
  <div class="modify-sn" *ngIf="!!state.dataLoaded && !!state.lookupLoaded">
    <div class="detailed-quotation">
      <aside class="sidebar-view">
        <figure class="showcase alt">
          <img src="../../assets/i/carimage-sidebar@2x.jpg" alt="" />
          <div class="fig-caption">
            <h4 class="alt">{{quote.vSel3.make }} {{quote.vSel3.carModel}} <span>${{quote.vSel3.sellingPrice || '...' }}</span></h4>
          </div>
        </figure>
        <div class="result">
          <h3>Results from the calculation</h3>
          <div class="detail-list">
            <div class="rw" *ngFor="let item of quote.vSel3.result">
              <div class="entity">{{item.entity}}</div>
              <div class="val">{{item.value}}</div>
              <div class="clear"></div>
            </div>
          </div>
        </div>
        <!-- /.result -->

        <div class="other-terms">
          <h5>Other Terms</h5>
          <div class="detail-list">
            <div class="rw" *ngFor="let item of quote.vSel3.otherTerms">
              <div class="entity">{{item.entity}}</div>
              <div class="val">{{item.value}}</div>
              <div class="clear"></div>
            </div>
          </div>
        </div>
      </aside>
      <form class="form-modify">
        <div class="expandable-sn">
          <header>
            <h3><a class="toggle-handle arrow"></a> <span>General</span></h3>
          </header>
          <div class="con-sn">
            <div class="col">
                <div class="gr">
                  <div class="inner">
                    <h6>Date</h6>
                    <div class="val">
                    <app-select [childClass]="'select-ctrl'"
                      [isOpen]="false"
                      [list]="lookup.date"
                      [placeholder]= "''"
                      [(val)] = "quote.vSel3.date"
                      [default] = "''"
                      [prefix] = "''"
                    ></app-select>
                    </div>
                  </div>
                </div>
            </div>
            <div class="col">
              <div class="gr">
                <div class="inner">
                  <h6>Customer Type</h6>
                  <div class="val">
                  <app-select [childClass]="'select-ctrl'"
                    [isOpen]="false"
                    [list]="lookup.custType"
                    [placeholder]= "''"
                    [(val)] = "quote.vSel3.custType"
                    [default] = "''"
                    [prefix] = "''"
                  ></app-select>
                  </div>
                </div>
              </div>
            </div>
            <div class="col centerd">
              <div class="new-old">
                <a class="new-el radio-ctrl" 
                [class.checked]="!!quote.vSel3.isNew"
                (click) = "quote.vSel3.isNew=true"
                >New</a>
                <a class="new-el radio-ctrl" 
                [class.checked]="!quote.vSel3.isNew"
                (click) = "quote.vSel3.isNew=false"
                >Semi New / Used</a>
              </div>
              <!-- /.new-old -->
            </div>
          </div>
          <!-- /.con-sn -->
        </div>
        <!-- /.expandable-sn -->
        <div class="expandable-sn spacing-t">
          <header>
            <h3><a class="toggle-handle arrow"></a> <span>Car Details</span></h3>
          </header>
          <div class="wrapper-expcon">
            <div class="con-sn">
              <div class="col">
                <div class="gr">
                  <div class="inner">
                    <h6>Model Year  <span class="required">*</span></h6>
                    <div class="val">
                    <app-select [childClass]="'select-ctrl'"
                      [isOpen]="false"
                      [list]="lookup.modelYear"
                      [placeholder]= "''"
                      [(val)] = "quote.vSel3.modelYear"
                      [default] = "''"
                      [prefix] = "''"
                    ></app-select>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="gr">
                  <div class="inner">
                    <h6>Make  <span class="required">*</span></h6>
                    <div class="val">
                    <app-select [childClass]="'select-ctrl'"
                      [isOpen]="false"
                      [list]="lookup.make"
                      [placeholder]= "''"
                      [(val)] = "quote.vSel3.make"
                      [default] = "''"
                      [prefix] = "''"
                    ></app-select>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="gr has-chk">
                  <div class="inner">
                    <h6>Model  <span class="required">*</span></h6>
                    <div class="val">
                    <app-select [childClass]="'select-ctrl'"
                      [isOpen]="false"
                      [list]="lookup.carModel"
                      [placeholder]= "''"
                      [(val)] = "quote.vSel3.carModel"
                      [default] = "''"
                      [prefix] = "''"
                    ></app-select>
                    </div>
                  </div>
                  <div class="inner rt">
                    <a class="chk-ctrl" 
                    [class.checked]="quote.vSel3.isAllModel"
                    (click) = "quote.vSel3.isAllModel=!!quote.vSel3.isAllModel?false:true"
                    >All</a>
                  </div>
                  <div class="clear"></div>
                </div>
              </div>
            </div>
            <!-- /.con-sn -->

            <div class="con-sn">
              <div class="col">
                <div class="gr">
                  <div class="inner">
                    <h6>Category  <span class="required">*</span></h6>
                    <div class="val">
                    <app-select [childClass]="'select-ctrl'"
                      [isOpen]="false"
                      [list]="lookup.category"
                      [placeholder]= "''"
                      [(val)] = "quote.vSel3.category"
                      [default] = "''"
                      [prefix] = "''"
                    ></app-select>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="gr">
                  <div class="inner">
                    <h6>Term <span class="required">*</span></h6>
                    <div class="val">
                      <input type="text" class="input-ctrl" name="term" [(ngModel)] = "quote.vSel3.term" />
                    </div>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="gr">
                  <div class="inner">
                    <h6>Selling Price <span class="required">*</span></h6>
                    <div class="val">
                      <input type="text" class="input-ctrl" name="sellingPrice" [(ngModel)] = "quote.vSel3.sellingPrice" />
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <!-- /.con-sn -->

            <div class="con-sn">
              <div class="col">
                <div class="gr">
                  <div class="inner">
                    <h6>Vehicle usage <span class="required">*</span></h6>
                    <div class="val">
                    <app-select [childClass]="'select-ctrl'"
                      [isOpen]="false"
                      [list]="lookup.verhicleUsage"
                      [placeholder]= "''"
                      [(val)] = "quote.vSel3.verhicleUsage"
                      [default] = "''"
                      [prefix] = "''"
                    ></app-select>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="gr has-chk">
                  <div class="inner">
                    <h6>Plans <span class="required">*</span></h6>
                    <div class="val">
                      <input type="text" class="input-ctrl" name="plans" [(ngModel)] = "quote.vSel3.plans" />
                    </div>
                  </div>
                  <div class="inner rt">
                    <a class="chk-ctrl" 
                    [class.checked]="quote.vSel3.isAllPlans"
                    (click) = "quote.vSel3.isAllPlans=!!quote.vSel3.isAllPlans?false:true"
                    >All</a>
                  </div>

                </div>
              </div>
              <div class="col">
                <div class="gr">
                  <div class="inner">
                    <h6>Plan Details <span class="required">*</span></h6>
                    <div class="val">
                    <app-select [childClass]="'select-ctrl'"
                      [isOpen]="false"
                      [list]="lookup.planDetails"
                      [placeholder]= "''"
                      [(val)] = "quote.vSel3.planDetails"
                      [default] = "''"
                      [prefix] = "''"
                    ></app-select>
                    </div>
                  </div>
                  <div class="clear"></div>
                </div>
              </div>
            </div>
            <!-- /.con-sn -->
            <div class="con-sn">
              
              <div class="col">
                <div class="gr has-chk">
                  <div class="inner rt">
                    <a class="chk-ctrl flipped" 
                    [class.checked]="quote.vSel3.isFixedRate"
                    (click) = "quote.vSel3.isFixedRate=!!quote.vSel3.isFixedRate?false:true"
                    >Fixed rate</a>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="gr has-chk">
                  <div class="inner rt">
                    <a class="chk-ctrl flipped" 
                    [class.checked]="quote.vSel3.withResource"
                    (click) = "quote.vSel3.withResource=!!quote.vSel3.withResource?false:true"
                    >With Resource</a>
                  </div>
                </div>
              </div>
              <div class="col">
                <div class="gr has-chk">
                  <div class="inner rt">
                    <a class="chk-ctrl flipped" 
                    [class.checked]="quote.vSel3.isFleet"
                    (click) = "quote.vSel3.isFleet=!!quote.vSel3.isFleet?false:true"
                    >Fleet</a>
                  </div>
                </div>
              </div>
            </div>
            <!-- /.con-sn -->
          </div>
          <!-- /.wrapper-expcon -->
        </div>
        <!-- /.expandable-sn -->
        <div class="expandable-sn spacing-t">
          <header>
            <h3><a class="toggle-handle arrow"></a> <span>VAPs and Fees</span></h3>
          </header>
          <div class="wrapper-expcon">
            <div class="con-sn"
              *ngFor="let item of vap.allItems; let i = index"
             >
             <div class="col">
                <div class="gr has-chk">
                  <div class="inner rt">
                    <a class="chk-ctrl flipped" 
                    [class.grayed]="item.isChkDisabled"
                    [class.checked]="item.isSelected"
                    (click) = "item.isSelected=!!item.isSelected?false:true"
                    >{{item.label}} <span *ngIf="item.isRequired" class="required">*</span></a>
                  </div>
                </div>
              </div>
              
              <div class="col">
                <div class="gr">
                  <div class="inner">
                    <div class="val has-add"
                    *ngIf="!!item.typeValue"
                    >
                        <input type="text" class="input-ctrl"  name="elvalue" value="{{item.typeValue}}" />
                        <a class="add"></a>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="col">
                <div class="bar-data-shifter">
                  <div class="el-wrap">
                    <input type="text" class="input-ctrl" name="financed" value = "{{item.amount}}"  
                    (change)="updateInputValue($event,item)"
                    [class.cleared]="!item.isFinanced"
                    /> 
                  </div>
                  <a class="shift-button"
                  [class.backward]="!item.isFinanced"
                  (click) = "item.isFinanced = !!item.isFinanced?false:true"
                  ></a>
                  <div class="el-wrap">
                    <input type="text" name="non-financed" class="input-ctrl" value = "{{item.amount}}"  
                    (change)="updateInputValue($event,item)"
                    [class.cleared]="!!item.isFinanced"
                     /> 
                  </div>
                  <div class="clear"></div>
                </div>
                <!-- /.bar-data-shifter -->
              </div>
            </div>
            <!-- /.con-sn -->

            <div class="con-sn total-bar">
              <div class="col"></div>
              <div class="col"><span class="total-lbl">Total Amount</span></div>
              <div class="col ">
                <div class="total">
                  <div class="lt">{{vap.totalFinanced}}</div>
                  <div class="rt">{{vap.totalNonFinanced}}</div>
                </div>
              </div>
            </div>
            <!-- /.con-sn total-bar -->

            <div class="con-sn">
              <div class="col">
                  <div class="gr">
                    <div class="inner">
                      <h6>Security Deposit (Quantity)</h6>
                      <div class="val">
                        <input type="text" class="input-ctrl" name="securityDeposit" [(ngModel)] = "vap.securityDeposit" />
                      </div>
                    </div>
                  </div>
              </div>
              <div class="col">
                  <div class="gr">
                    <div class="inner">
                      <h6>1st Extraordinary Payment (Percentage)</h6>
                      <div class="val">
                        <input type="text" class="input-ctrl" name="extPayment" [(ngModel)] = "vap.extPayment" />
                      </div>
                    </div>
                  </div>
              </div>
              <div class="col">
                  <div class="gr">
                    <div class="inner">
                      <h6>Residual Value</h6>
                      <div class="val">
                        <input type="text" class="input-ctrl" name="resiudualValue" [(ngModel)] = "vap.resiudualValue" />
                      </div>
                    </div>
                  </div>
              </div>
            </div>
            <!-- /.con-sn -->
            <div class="con-sn">
              <div class="col">
                  <div class="gr">
                    <div class="inner">
                      <h6>1st Extraordinary Payment (Value)</h6>
                      <div class="val">
                        <input type="text" class="input-ctrl" name="extPayment1Val" [(ngModel)]="vap.extPayment1Val" />
                      </div>
                    </div>
                  </div>
              </div>
              <div class="col">
                  <div class="gr">
                    <div class="inner">
                      <h6>Security Deposit (Value)</h6>
                      <div class="val">
                        <input type="text" class="input-ctrl" name="securityValue" [ngModel]="vap.securityValue" />
                      </div>
                    </div>
                  </div>
              </div>
            </div>
            <!-- /.con-sn -->

          </div>
          <!-- /.wrapper-expcon -->
        </div>
        <!-- /.expandable-sn -->
      </form>
      <!-- /.form-modify -->
    </div>
    <!-- /.detailed-quotation -->
    <div class="actions footer-actions spacing-b">
    <div class="grouped-btns lt">
      <a class="btn prev" routerLink="/quotation/2" (click)="goToStep(activeStep-1)">Previous <i></i></a>
      </div>
      <div class="grouped-btns rt">
        <a class="btn btn-secondary">Print</a>
        <a class="btn btn-secondary">Email</a>
        <a class="btn btn-secondary">Save</a>
        <a class="btn btn-secondary">Amortization table</a>
        <a class="btn btn-secondary">Payment Schedule</a>
        <a class="btn btn-secondary" (click)="showPreApprovalModal(true)">PreApproval</a>
        <a class="btn btn-secondary">Full Application</a>
      </div>
      <!-- /.grouped-btns -->
    </div>
  </div>
  <!-- /.create-sn -->
</main>
<!-- /.main -->


<div class="modal"
*ngIf="!!state.isPreApprovalModal">
  <div class="modal-con modal-pre-approval">

    <div class="note">Please complete this customer details form first.</div>

    <div class="toggle-sn">
      <h3>Comments</h3>
      <p class="comment">comments</p>
    </div>
    <!-- /.toggle-sn -->
    <div class="toggle-sn">
      <h3>Id Verification</h3>
      <ul class="list">
        <li><span class="id">Verification</span> <a class="status">Upload <input type="file" class="input-upload"/></a></li>
      </ul>
    </div>
    <div class="actions">
      <a class="btn btn-secondary" (click)="showPreApprovalModal(false)" >Cancel</a>
      <a class="btn" routerLink="/quotationApplicant" >Accept</a>
    </div>
    <!-- /.actions -->
  </div>
  <!-- /.modal-con modal-alert -->
</div>
<!-- /.isPreApprovalModal -->

